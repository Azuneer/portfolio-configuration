# Redirection HTTP → HTTPS
server {
    listen 80;
    listen [::]:80;
    server_name ewengadonnaud.xyz www.ewengadonnaud.xyz;
    return 301 https://$server_name$request_uri;
}

# Configuration HTTPS principale
server {
    listen 443 ssl;
    listen [::]:443 ssl;
    http2 on;
    server_name ewengadonnaud.xyz www.ewengadonnaud.xyz;
    
    root /var/www/mon-portfolio;
    index index.html;
    
    # SSL Certificates
    [CONFIDENTIEL]
    
    # Cacher la version Nginx
    server_tokens off;
    
    # Rate limiting
    limit_req zone=general burst=20 nodelay;
    
    # Bannir les IPs malveillantes
    deny 195.178.110.160;
    deny 104.23.221.142;
    deny 104.23.221.143;
    deny 35.233.210.231;
    deny 34.187.212.26;
    deny 34.11.205.87;
    deny 136.117.72.223;
    deny 35.197.17.94;
    deny 35.185.243.182;
    deny 34.168.16.43;
    
    # Bloquer les méthodes HTTP non autorisées
    if ($request_method !~ ^(GET|HEAD|POST)$) {
        return 444;
    }
    
    # Cache des images (1 an)
    location ~* \.(jpg|jpeg|png|gif|ico|svg|webp|avif)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # Cache des fonts (1 an)
    location ~* \.(woff|woff2|ttf|otf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # Cache CSS et JS (6 mois)
    location ~* \.(css|js)$ {
        expires 6M;
        add_header Cache-Control "public";
    }
    
    # Bloquer WordPress et scans de vulnérabilités
    location ~* ^/(wp-|wordpress|cgi-bin) {
        return 444;
    }
    
    # Bloquer les fichiers sensibles
    location ~* /(\.env|\.git|config\.php|phpinfo|setup-config) {
        return 444;
    }
    
    # Bloquer les chemins d'administration suspects
    location ~* ^/(admin|api/\.env|backend/\.env|_profiler) {
        return 444;
    }
    
    # Favicon
    location = /favicon.ico {
        access_log off;
        log_not_found off;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
    
    # Robots.txt
    location = /robots.txt {
        access_log off;
        log_not_found off;
        expires 1y;
        add_header Cache-Control "public";
    }
    
    # Route principale
    location / {
        try_files $uri $uri/ =404;
    }
}